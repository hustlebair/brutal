---
interface Props {
  pageTitle?: string;
}

const navigationItems = [
  { name: 'Blog', url: '/blog/' },
];

const categories = [
  {
    name: 'Gadgets',
    items: [
      { name: 'Headphones', url: '#' },
      { name: 'Chargers', url: '#' },
      { name: 'Smart Lights', url: '#' },
    ],
  },
  {
    name: 'Home Stuff',
    items: [
      { name: 'Kitchen', url: '#' },
      { name: 'Desk Setup', url: '#' },
      { name: 'Organization', url: '#' },
    ],
  },
  {
    name: 'Funny Gifts',
    items: [
      { name: 'Pranks', url: '#' },
      { name: 'Gag Gifts', url: '#' },
      { name: 'Party', url: '#' },
    ],
  },
  {
    name: 'TikTok Finds',
    items: [
      { name: 'Viral Tech', url: '#' },
      { name: 'Room Aesthetic', url: '#' },
      { name: 'Creator Tools', url: '#' },
    ],
  },
];

const tiktokUrl = 'https://www.tiktok.com/@highestliked';

const { pageTitle } = Astro.props;
---

<header class='site-nav sticky top-0 z-50 bg-white border-b-4 border-black'>
  {pageTitle && <h1 class='hidden'>{pageTitle}</h1>}
  <div class='container mx-auto px-4'>
    <div class='nav-bar flex items-center justify-between py-2'>
      <!-- Left: Logo -->
      <div class='shrink-0'>
        <a href='/' title='Back to Home' class='block'>
          <img 
            src='/highestlikedlogo.png' 
            alt='Highest Liked' 
            class='logo-image w-auto object-contain'
            loading='eager'
          />
        </a>
      </div>

      <!-- Center: Categories (desktop) -->
      <div class='hidden md:flex flex-1 justify-center items-center gap-6 px-4'>
        {categories.map((cat) => (
          <div class='relative group'>
            <button class='poppins text-base font-semibold hover:text-[#FCB55B] transition-colors'>
              {cat.name}
              <span class='ml-1'>▾</span>
            </button>
            <div class='absolute left-1/2 -translate-x-1/2 mt-2 hidden group-hover:block bg-white border-2 border-black rounded-xl shadow-lg min-w-[220px] z-50'>
              <ul class='p-2'>
                {cat.items.map((sub) => (
                  <li>
                    <a href={sub.url} class='block px-4 py-2 text-sm hover:bg-[#FFF4E5] rounded-lg'>
                      {sub.name}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          </div>
        ))}
      </div>

      <!-- Right: Links -->
      <div class='hidden md:flex items-center gap-6 shrink-0'>
        {navigationItems.map((item) => (
          <a
            class='poppins text-base font-semibold hover:text-[#FCB55B] transition-colors'
            href={item.url}
            title={`Go to ${item.name}`}
          >
            {item.name}
          </a>
        ))}
        <a href={tiktokUrl} target='_blank' title='TikTok' aria-label='TikTok'
          class='inline-flex items-center justify-center'>
          <img src='/icon/tiktokicon.png' alt='TikTok' class='h-6 w-6 object-contain align-middle' loading='eager' />
        </a>
      </div>

      <!-- Mobile: hamburger -->
      <button class='md:hidden border-2 border-black px-3 py-2 rounded-lg flex flex-col gap-1.5' id='navToggle' aria-label='Toggle menu' aria-expanded='false'>
        <span class='hamburger-line'></span>
        <span class='hamburger-line'></span>
        <span class='hamburger-line'></span>
      </button>
    </div>

    <!-- Mobile menu overlay -->
    <div class='md:hidden fixed left-0 right-0 bg-white z-50 hidden flex-col p-4 overflow-y-auto' id='mobileMenu' style='max-height: 70vh; box-shadow: 0 12px 40px -10px rgba(0, 0, 0, 0.7);'>
      {navigationItems.map((item) => (
        <a class='block mb-3 px-4 py-3 bg-gray-100 rounded-lg font-semibold text-gray-900' href={item.url}>{item.name}</a>
      ))}
      <a class='block mb-3 px-4 py-3 bg-gray-100 rounded-lg font-semibold text-gray-900' href={tiktokUrl} target='_blank'>TikTok</a>
      {categories.map((cat) => (
        <details class='mb-3 bg-gray-100 rounded-lg'>
          <summary class='block px-4 py-3 font-semibold cursor-pointer rounded-lg list-none text-gray-900 flex items-center justify-between'>
            <span>{cat.name}</span>
            <span class='ml-2'>▾</span>
          </summary>
          <ul class='px-4 pb-3 pt-0 space-y-1'>
            {cat.items.map((sub) => (
              <li><a class='block px-2 py-2 text-sm rounded text-gray-700' href={sub.url}>{sub.name}</a></li>
            ))}
          </ul>
        </details>
      ))}
    </div>
  </div>
</header>

<style>
  .logo-image {
    display: block;
    height: 2.25rem; /* 36px */
  }

  @media (min-width: 768px) {
    .logo-image {
      height: 2.75rem; /* 44px */
    }
  }

  .hamburger-line {
    width: 24px;
    height: 2px;
    background-color: #000;
    transition: all 0.3s ease;
  }

  #navToggle[aria-expanded="true"] .hamburger-line:nth-child(1) {
    transform: rotate(45deg) translate(6px, 6px);
  }

  #navToggle[aria-expanded="true"] .hamburger-line:nth-child(2) {
    opacity: 0;
  }

  #navToggle[aria-expanded="true"] .hamburger-line:nth-child(3) {
    transform: rotate(-45deg) translate(6px, -6px);
  }
</style>

<script>
  document.addEventListener('astro:page-load', () => {
    const navBar = document.querySelector('.site-nav .nav-bar');
    const navToggle = document.getElementById('navToggle');
    const mobileMenu = document.getElementById('mobileMenu');

    // Set mobile menu top position based on nav height
    const updateMobileMenuPosition = () => {
      if (mobileMenu && navBar) {
        const navHeight = navBar.getBoundingClientRect().height;
        const header = navBar.closest('header');
        const headerBottom = header ? header.getBoundingClientRect().bottom : navHeight;
        mobileMenu.style.top = `${headerBottom}px`;
      }
    };

    // Initial state
    updateMobileMenuPosition();
    window.addEventListener('resize', updateMobileMenuPosition);

    navToggle?.addEventListener('click', () => {
      const isOpen = !mobileMenu?.classList.contains('hidden');
      if (isOpen) {
        mobileMenu?.classList.add('hidden');
        navToggle?.setAttribute('aria-expanded', 'false');
      } else {
        updateMobileMenuPosition();
        mobileMenu?.classList.remove('hidden');
        navToggle?.setAttribute('aria-expanded', 'true');
      }
    });
  });
</script>
